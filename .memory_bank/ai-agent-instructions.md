# Инструкции для ИИ-Агентов: Fiction Library Memory Bank

## Общие Принципы для Всех ИИ-Агентов

Независимо от того, какой ИИ-инструмент вы используете (Cline, Cursor, Windsurf, Claude, ChatGPT, или другие), следуйте этим принципам при работе с проектом Fiction Library.

## Обязательный Протокол Запуска

### 1. Чтение Memory Bank (КРИТИЧНО)
При начале ЛЮБОЙ сессии работы с проектом:

```bash
# Обязательные файлы для чтения:
.memory_bank/activeContext.md     # Текущие задачи и планы
.memory_bank/projectbrief.md      # Цели и границы проекта
.memory_bank/systemPatterns.md    # Архитектурные паттерны
.memory_bank/techContext.md       # Технологический стек
.memory_bank/progress.md          # Статус и Git-синхронизация
```

### 2. Git-Синхронизация
```bash
# Проверить актуальность документации:
git log -1 --format="%H"
# Сравнить с хешем из progress.md
# Если различаются - выполнить git diff и обновить Memory Bank
```

## Специфические Настройки по Инструментам

### Cline / Roo Code
- **Файл конфигурации**: `.clinerules` (уже создан)
- **Особенности**: Прямой доступ к файловой системе и терминалу
- **Преимущества**: Автоматическое выполнение команд Git

### Cursor
- **Файл конфигурации**: `.cursorrules` (уже создан)  
- **Особенности**: Интеграция с Composer и Chat
- **Преимущества**: Контекстное автодополнение с учетом Memory Bank

### Windsurf (Codeium)
- **Файл конфигурации**: Создать `.windsurfrules` или использовать системные промпты
- **Настройка**: Добавить в настройки проекта чтение Memory Bank файлов
- **Команды**: Использовать Cascade для автоматического контекста

### ChatGPT / Claude (Веб-интерфейс)
- **Настройка**: Вручную загружать содержимое Memory Bank файлов в начале сессии
- **Ограничения**: Нет прямого доступа к файловой системе
- **Решение**: Копировать содержимое ключевых файлов в промпт

### GitHub Copilot
- **Настройка**: Открыть все файлы Memory Bank в редакторе для контекста
- **Ограничения**: Только автодополнение, нет управления документацией
- **Использование**: Как вспомогательный инструмент с основным агентом

## Универсальный Рабочий Процесс

### Фаза 1: Инициализация (Каждая сессия)
1. **Загрузка контекста**:
   - Прочитать `activeContext.md` для понимания текущих задач
   - Проверить `progress.md` на актуальность Git-хеша
   - Изучить `systemPatterns.md` для архитектурных требований

2. **Синхронизация с кодом**:
   - Сравнить Git-хеш из `progress.md` с текущим
   - При расхождении: проанализировать `git diff` и обновить документацию
   - Обновить хеш в `progress.md`

### Фаза 2: Планирование
1. **Анализ задачи**:
   - Сверить задачу с целями из `projectbrief.md`
   - Проверить соответствие пользовательским требованиям из `productContext.md`
   - Выбрать подходящие паттерны из `systemPatterns.md`

2. **Создание плана**:
   - Обновить `activeContext.md` с детальным планом
   - Указать используемые технологии из `techContext.md`
   - Определить этапы реализации

### Фаза 3: Реализация
1. **Следование стандартам**:
   - Использовать только технологии из `techContext.md`
   - Применять паттерны из `systemPatterns.md`
   - Соблюдать стандарты именования и структуры

2. **Документирование изменений**:
   - При новых паттернах: обновить `systemPatterns.md`
   - При новых зависимостях: обновить `techContext.md`
   - При изменении бизнес-логики: проверить `productContext.md`

### Фаза 4: Завершение
1. **Обновление статуса**:
   - Отметить выполненные задачи в `progress.md`
   - Очистить детали из `activeContext.md`, оставив высокоуровневый фокус
   - Обновить Git-хеш в `progress.md`

2. **Проверка качества**:
   - Убедиться в соответствии кода паттернам
   - Проверить актуальность всей документации
   - Зафиксировать изменения в Git

## Критические Правила (Для Всех Агентов)

### ✅ ОБЯЗАТЕЛЬНО
- Читать Memory Bank в начале каждой сессии
- Обновлять `activeContext.md` перед написанием кода
- Следовать паттернам из `systemPatterns.md`
- Проверять Git-синхронизацию
- Обновлять документацию при изменениях

### ❌ ЗАПРЕЩЕНО
- Писать код без чтения Memory Bank
- Использовать технологии не из `techContext.md`
- Противоречить целям из `projectbrief.md`
- Игнорировать архитектурные паттерны
- Оставлять документацию неактуальной

## Специфика Проекта Fiction Library

### Ключевые Компоненты
- **Telegram API**: Сложная интеграция, требует специальных паттернов
- **Асинхронные очереди**: Критично для производительности
- **Система дедупликации**: Важна для качества данных
- **Миграция файлов**: Безопасность и надежность приоритетны

### Технологические Ограничения
- **Next.js 15.5.9**: Обязательная версия
- **TypeScript**: Строгий режим включен
- **Supabase**: Единственная БД, RLS обязателен
- **Cloud.ru S3**: Основное файловое хранилище

### Архитектурные Паттерны
- **Repository Pattern**: Для всех операций с данными
- **Queue Pattern**: Для асинхронных задач
- **Service Layer**: Для бизнес-логики
- **Factory Pattern**: Для Telegram клиентов

## Команды для Быстрого Доступа

### Чтение Memory Bank
```bash
# Основные файлы
cat .memory_bank/activeContext.md
cat .memory_bank/systemPatterns.md
cat .memory_bank/progress.md

# Полный контекст
ls .memory_bank/
```

### Git-операции
```bash
# Текущий хеш
git log -1 --format="%H"

# Сравнение с последним проверенным
git diff [хеш_из_progress.md] HEAD

# История изменений
git log --oneline -10
```

### Проектные команды
```bash
# Разработка
pnpm dev                    # Запуск сервера разработки
pnpm build                  # Сборка проекта
pnpm lint                   # Проверка кода

# Telegram синхронизация
pnpm book-worm             # Основная синхронизация
pnpm book-worm:scheduled   # Плановая синхронизация

# Система очередей
pnpm worker                # Обработчик очередей
pnpm check-download-queue  # Статус очередей

# Тестирование
pnpm test:telegram-download # Тест Telegram
pnpm test:queue-system     # Тест очередей
```

## Метрики Эффективности

### Для Агента
- **Время загрузки контекста**: < 30 секунд
- **Соответствие паттернам**: 100%
- **Актуальность документации**: Синхронизация с каждым коммитом

### Для Проекта
- **Качество кода**: Соответствие TypeScript strict mode
- **Архитектурная консистентность**: Следование установленным паттернам
- **Производительность**: Время загрузки < 2 секунд

## Troubleshooting

### Проблема: Memory Bank не синхронизирован
**Решение**:
1. Выполнить `git log -1 --format="%H"`
2. Сравнить с хешем в `progress.md`
3. Выполнить `git diff [старый_хеш] HEAD`
4. Обновить соответствующие файлы Memory Bank

### Проблема: Неизвестные технологии в коде
**Решение**:
1. Проверить `techContext.md` на наличие технологии
2. Если нет - либо добавить с обоснованием, либо заменить на разрешенную
3. Обновить документацию

### Проблема: Код не соответствует паттернам
**Решение**:
1. Изучить `systemPatterns.md`
2. Рефакторить код согласно паттернам
3. При необходимости обновить паттерны с обоснованием

## Заключение

Memory Bank - это не просто документация, это внешняя память ИИ-агента. Относитесь к ней как к критически важному компоненту системы, который обеспечивает непрерывность и качество разработки проекта Fiction Library.