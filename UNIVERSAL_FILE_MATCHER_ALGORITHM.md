# Универсальный алгоритм релевантного поиска файлов для книг

## Описание

Универсальный алгоритм релевантного поиска, разработанный для сопоставления файлов с книгами по названию и автору. Алгоритм учитывает специфику имен файлов и заголовков книг, обеспечивая точное сопоставление даже при наличии разных вариантов написания.

## Принципы работы

### 1. Нормализация строк
- Приведение к NFC нормализации Unicode
- Преобразование в нижний регистр
- Замена "ё" на "е"

### 2. Извлечение слов
- Разделение по всем возможным разделителям: пробелы, дефисы, скобки, точки, запятые, и другие специальные символы
- Удаление русских союзов (например: "и", "или", "а", "но", "в", "на", "не", "ни" и т.д.)
- Удаление слова "цикл" как малоинформативного
- Удаление слов короче 2 символов

### 3. Алгоритм сопоставления
- Ищем совпадение каждого из слов, полученных из имени файла, с массивом слов, полученных из автора и названия книги
- Совпадением считается: точное совпадение или частичное вхождение одного слова в другое (например: "волк" и "волкодав" считается совпадением)
- Каждое совпадение дает 20 баллов

### 4. Порог релевантности
- Минимальный порог: 50 баллов
- Файлы с оценкой ниже порога отбрасываются

### 5. Формат файла
- Формат файла не учитывается при оценке релевантности

### 6. MIME-типы
- Не фильтруются по MIME-типу

## Использование

### Для поиска подходящих файлов:
```typescript
import { UniversalFileMatcher } from '@/lib/universal-file-matcher';

const matchingFiles = UniversalFileMatcher.findMatchingFiles(book, allFiles);
```

### Для проверки релевантности конкретного файла:
```typescript
const isRelevant = UniversalFileMatcher.isFileRelevant(file, book);
```

### Для получения деталей сопоставления:
```typescript
const matchResult = UniversalFileMatcher.matchFileToBook(file, book);
console.log(`Оценка релевантности: ${matchResult.score}`);
console.log(`Совпавшие слова: ${matchResult.matchedWords.join(', ')}`);
```

## Примеры

### Пример 1: Точное совпадение
- Имя файла: "Станислав_Сергеев_Солдаты_Армегеддона.zip"
- Название книги: "Солдаты Армагеддона" 
- Автор: "Станислав Сергеев"
- Совпадения: "станислав", "сергеев", "солдаты", "армегеддона" (частичное вхождение)
- Оценка: 4 совпадения × 20 = 80 баллов → Релевантный файл

### Пример 2: Частичное совпадение
- Имя файла: "Варяг. Волкодав в краю овёс и мёда.fb2"
- Название книги: "Волкодав в краю овёс и мёда"
- Автор: "Мария Семёнова"
- Совпадения: "волкодав", "овёс", "мёда", "семёнова"
- Оценка: 4 совпадения × 20 = 80 баллов → Релевантный файл

## Принципы начисления баллов

- Совпадение слова из имени файла с любым словом из названия или автора: 20 баллов
- Совпадением считается точное совпадение или частичное вхождение одного слова в другое
- Максимальная оценка: не ограничена, но типично 80-160 баллов для точного совпадения

## Возвращаемые результаты

Функции возвращают:
- Для `findMatchingFiles`: массив файлов, релевантных книге (оценка >= 50), отсортированный по убыванию релевантности
- Для `matchFileToBook`: объект с оценкой, файлом и списком совпавших слов
- Для `isFileRelevant`: boolean значение (true, если оценка >= порога)