# Описание алгоритма ранжирования релевантности книг

## Общее описание

Алгоритм ранжирования релевантности книг используется для определения наилучшего соответствия между файлом из Telegram и записью книги в базе данных. Алгоритм анализирует совпадения слов между именем файла и полями автора и названия книг в базе данных.

## Алгоритм работы

### 1. Извлечение слов из имени файла

Алгоритм разбивает имя файла на составные слова, используя следующие разделители:
- Подчеркивание (_)
- Дефис (-)
- Пробелы

Пример: "Мюррей_Лейнстер_Колониальная_служба_Сборник.fb2" → ["Мюррей", "Лейнстер", "Колониальная", "служба", "Сборник"]

### 2. Сравнение с записями в базе данных

Для каждой книги из результатов поиска алгоритм вычисляет релевантность по следующим критериям:

#### Базовые баллы за совпадение слов
- Совпадение слова в названии книги: +8 баллов
- Совпадение слова в авторе книги: +5 баллов

#### Бонусные баллы
- Полное совпадение всех слов: +30 баллов
- Совпадение большинства слов (≥70%): +15 баллов
- Совпадение половины слов (≥50%): +10 баллов
- Точное совпадение автора: +30 баллов
- Точное совпадение названия: +60 баллов
- Точное совпадение и автора, и названия: +40 баллов (дополнительно)
- Наличие и автора, и названия в записи: +20 баллов
- Совпадение поисковых терминов в названии: +3 балла за термин
- Совпадение поисковых терминов в авторе: +2 балла за термин

### 3. Пример расчета

Для файла "Мюррей_Лейнстер_Колониальная_служба_Сборник.fb2":

Извлеченные слова: ["мюррей", "лейнстер", "колониальная", "служба", "сборник"] (5 слов)

Сравнение с книгой "Колониальная служба (1956)" автора "Мюррей Лейнстер":
- Совпадения в названии: "колониальная" (+8), "служба" (+8) = 16 баллов
- Совпадения в авторе: "мюррей" (+5), "лейнстер" (+5) = 10 баллов
- Наличие и автора, и названия: +20 баллов
- Частичное совпадение слов (4 из 5): +10 баллов

Итого: 16 + 10 + 20 + 10 = 56 баллов

### 4. Порог релевантности

Временно понижен порог релевантности до 45 баллов для тестирования.

Книга считается подходящей, если её релевантность ≥ 45 баллов.

## История изменений

- 2025-10-19: Увеличены баллы за совпадения слов и бонусы для улучшения точности определения релевантности
- 2025-10-19: Временно понижен порог с 50 до 45 баллов для тестирования