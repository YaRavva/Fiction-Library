import { config } from 'dotenv';
import { linkExistingBooks } from './link-existing-books';
import { fixDuplicates } from './fix-duplicates';
import { fullSync } from './full-sync';

// –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env —Ñ–∞–π–ª–∞
config();

async function resolveMissingBooks() {
  try {
    console.log('üöÄ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–º–∏ –∫–Ω–∏–≥–∞–º–∏\n');
    
    // –®–∞–≥ 1: –°–≤—è–∑—ã–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–Ω–∏–≥–∏ —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ Telegram
    console.log('–®–∞–≥ 1: –°–≤—è–∑—ã–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–Ω–∏–≥ —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ Telegram');
    console.log('=====================================================');
    await linkExistingBooks();
    
    // –®–∞–≥ 2: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã
    console.log('\n–®–∞–≥ 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∫–Ω–∏–≥');
    console.log('================================');
    await fixDuplicates();
    
    // –®–∞–≥ 3: –í—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
    console.log('\n–®–∞–≥ 3: –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Telegram');
    console.log('=====================================');
    await fullSync();
    
    console.log('\n‚úÖ –í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!');
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞:', error);
  }
}

// –ï—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—â–µ–Ω –Ω–∞–ø—Ä—è–º—É—é, –≤—ã–ø–æ–ª–Ω—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é
if (require.main === module) {
  resolveMissingBooks();
}