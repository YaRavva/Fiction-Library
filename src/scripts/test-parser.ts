/**
 * –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä—Å–µ—Ä–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
 * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ Telegram
 */

import { MetadataParser } from '../lib/telegram/parser.js';

// –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ Telegram
const testMessage = `–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞ –∏ —Ñ—ç–Ω—Ç–µ–∑–∏. –ü–æ–¥–±–æ—Ä–∫–∏
–ê–≤—Ç–æ—Ä: –ô–µ–Ω –ú–∞–∫–¥–æ–Ω–∞–ª—å–¥
–ù–∞–∑–≤–∞–Ω–∏–µ: —Ü–∏–∫–ª –õ—É–Ω–∞
–ñ–∞–Ω—Ä: #—Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞, #–∫–æ—Å–º–æ–æ–ø–µ—Ä–∞, #–ø–ª–∞–Ω–µ—Ç–∞—Ä–Ω–∞—è—Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞, #–ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è, #—Å–æ—Ü–∏–∞–ª—å–Ω–∞—è, #–ø—Ä–∏–∫–ª—é—á–µ–Ω—á–µ—Å–∫–æ–µ, #—Å–º–Ω–æ–∂–µ—Å—Ç–≤–æ–º–∏–Ω–≥—Ç—Ä–∏–≥, #–∑–∞–∫–æ–Ω—á–µ–Ω—Å–µ—Ä–∏—è
–†–µ–π—Ç–∏–Ω–≥: 7,50 #–≤—ã—à–µ7
–õ—É–Ω–∞ —Ö–æ—á–µ—Ç —Ç–µ–±—è —É–±–∏—Ç—å, –∏ —É –Ω–µ–µ –µ—Å—Ç—å —Ç—ã—Å—è—á–∏ —Å–ø–æ—Å–æ–±–æ–≤ –¥–æ–±–∏—Ç—å—Å—è —Å–≤–æ–µ–≥–æ. –í–∞–∫—É—É–º, —Ä–∞–¥–∏–∞—Ü–∏—è, —É–¥—É—à–∞—é—â–∞—è –ø—ã–ª—å, —Å–ª–∞–±–∞—è –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è, –∫–æ—Å—Ç–∏... –õ—É–Ω–∞ ‚Äî –Ω–æ–≤–æ–µ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ, –≥–¥–µ –Ω–µ—Ç –∑–∞–∫–æ–Ω–æ–≤, –Ω–æ –µ—Å—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏, –≥–¥–µ –∑–∞ –≤–æ–∑–¥—É—Ö –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –Ω–∞–¥–æ –ø–ª–∞—Ç–∏—Ç—å, –∏ –≤—Å–µ–º –ø—Ä–∞–≤—è—Ç –ø—è—Ç—å –î—Ä–∞–∫–æ–Ω–æ–≤ ‚Äî –ø—è—Ç—å –∏–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω—ã—Ö –∫–ª–∞–Ω–æ–≤. –ú–µ–∂–¥—É –Ω–∏–º–∏ –¥–∞–≤–Ω–æ –ø–æ–¥–µ–ª–µ–Ω—ã —Å—Ñ–µ—Ä—ã, –∫–∞–∂–¥—ã–π –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è —Å–≤–æ–∏–º –¥–µ–ª–æ–º, –Ω–æ –æ–±—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ä–æ–µ —Å—Ç–∞—Ä–µ—é, –∏—Ö —Å–º–µ—Ä—Ç—å —É–∂–µ –±–ª–∏–∑–∫–∞, –∏ –º–µ–∂–¥—É –º–Ω–æ–≥–æ—á–∏—Å–ª–µ–Ω–Ω—ã–º–∏ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞–º–∏ —Ä–∞–∑—ã–≥—Ä—ã–≤–∞–µ—Ç—Å—è –∂–µ—Å—Ç–æ–∫–∞—è –±–æ—Ä—å–±–∞ –∑–∞ –Ω–æ–≤—ã–µ —Å—Ñ–µ—Ä—ã. –ê–¥—Ä–∏–∞–Ω—ã –ö–æ—Ä—Ç–µ –≤–æ—Å–µ–º—å–¥–µ—Å—è—Ç. –ï–µ —Å–µ–º—å—è —É–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ—Ä–ø–æ—Ä–∞—Ü–∏–µ–π ¬´–ö–æ—Ä—Ç–µ –≠–ª–∏–æ¬ª. –ö–æ–º–ø–∞–Ω–∏—è –ê–¥—Ä–∏–∞–Ω—ã –≤ –∂–µ—Å—Ç–æ–∫–∏—Ö –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –≤–æ–π–Ω–∞—Ö, –Ω–æ –ø—Ä–∏–æ–±—Ä–µ–ª–∞ –Ω–µ–º–∞–ª–æ –≤—Ä–∞–≥–æ–≤. –ò —Ç–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ —Å —Ç–∞–∫–∏–º —Ç—Ä—É–¥–æ–º –∑–∞–≤–æ–µ–≤–∞–Ω–Ω—ã–π –º–∏—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç —Ç—Ä–µ—â–∞—Ç—å –ø–æ —à–≤–∞–º, –¥–µ—Ç–∏ –ê–¥—Ä–∏–∞–Ω—ã –¥–æ–ª–∂–Ω—ã —Å–ø–∞—Å—Ç–∏ –∏–º–ø–µ—Ä–∏—é –º–∞—Ç–µ—Ä–∏ –æ—Ç —Ä–∞–∑–≤–∞–ª–∞... –∏ –µ—â—ë –æ—Ç —Å–∞–º–∏—Ö —Å–µ–±—è. –¢–∞–∫ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö –º–∞—Å—à—Ç–∞–±–Ω—ã—Ö –Ω–∞—É—á–Ω–æ-—Ñ–∞–Ω—Ç–∞—Å—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–æ–º–∞–Ω–æ–≤ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ª–µ—Ç, —ç–ø–∏—á–µ—Å–∫–∞—è —Å–∞–≥–∞ –æ–± –∏–Ω—Ç—Ä–∏–≥–∞—Ö, –ø—Ä–µ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞—Ö –∏ –º–µ—Å—Ç–∏ –≤ –∑—Ä–∏–º–æ–º, –∂–µ—Å—Ç–∫–æ–º, –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–º –∏ –ø–æ—Ç—Ä—è—Å–∞—é—â–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–º –º–∏—Ä–µ –±—É–¥—É—â–µ–≥–æ.
–°–æ—Å—Ç–∞–≤:
1. –ù–æ–≤–∞—è –õ—É–Ω–∞ (2015)
2. –í–æ–ª—á—å—è –õ—É–Ω–∞ (2017)
3. –í–æ—Å—Å—Ç–∞–≤—à–∞—è –õ—É–Ω–∞ (2019)`;

console.log('üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä—Å–µ—Ä–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö\n');
console.log('üìù –ò—Å—Ö–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:');
console.log('‚îÄ'.repeat(80));
console.log(testMessage);
console.log('‚îÄ'.repeat(80));
console.log('');

// –ü–∞—Ä—Å–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ
const metadata = MetadataParser.parseMessage(testMessage);

console.log('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞:\n');

console.log('üìñ –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:');
console.log(`   –ê–≤—Ç–æ—Ä: ${metadata.author}`);
console.log(`   –ù–∞–∑–≤–∞–Ω–∏–µ: ${metadata.title}`);
console.log(`   –°–µ—Ä–∏—è: ${metadata.series || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}`);
console.log(`   –†–µ–π—Ç–∏–Ω–≥: ${metadata.rating}`);
console.log('');

console.log('üé≠ –ñ–∞–Ω—Ä—ã:');
if (metadata.genres.length > 0) {
  metadata.genres.forEach((genre, index) => {
    console.log(`   ${index + 1}. ${genre}`);
  });
} else {
  console.log('   ‚ùå –ñ–∞–Ω—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
}
console.log('');

console.log('üè∑Ô∏è  –¢–µ–≥–∏:');
if (metadata.tags.length > 0) {
  metadata.tags.forEach((tag, index) => {
    console.log(`   ${index + 1}. #${tag}`);
  });
} else {
  console.log('   ‚ùå –¢–µ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
}
console.log('');

console.log('üìù –û–ø–∏—Å–∞–Ω–∏–µ:');
if (metadata.description) {
  const preview = metadata.description.substring(0, 200);
  console.log(`   ${preview}${metadata.description.length > 200 ? '...' : ''}`);
  console.log(`   (–î–ª–∏–Ω–∞: ${metadata.description.length} —Å–∏–º–≤–æ–ª–æ–≤)`);
} else {
  console.log('   ‚ùå –û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
}
console.log('');

console.log('üìö –°–æ—Å—Ç–∞–≤ —Å–µ—Ä–∏–∏:');
if (metadata.books.length > 0) {
  metadata.books.forEach((book, index) => {
    console.log(`   ${index + 1}. ${book.title} (${book.year})`);
  });
} else {
  console.log('   ‚ùå –ö–Ω–∏–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
}
console.log('');

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏
console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏:');
const checks = [
  { name: '–ê–≤—Ç–æ—Ä –∏–∑–≤–ª–µ—á–µ–Ω', passed: metadata.author === '–ô–µ–Ω –ú–∞–∫–¥–æ–Ω–∞–ª—å–¥' },
  { name: '–ù–∞–∑–≤–∞–Ω–∏–µ –∏–∑–≤–ª–µ—á–µ–Ω–æ', passed: metadata.title === '—Ü–∏–∫–ª –õ—É–Ω–∞' },
  { name: '–°–µ—Ä–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞', passed: metadata.series === '—Ü–∏–∫–ª –õ—É–Ω–∞' },
  { name: '–†–µ–π—Ç–∏–Ω–≥ –∏–∑–≤–ª–µ—á–µ–Ω', passed: metadata.rating === 7.5 },
  { name: '–ñ–∞–Ω—Ä—ã –∏–∑–≤–ª–µ—á–µ–Ω—ã', passed: metadata.genres.length > 0 },
  { name: '–¢–µ–≥–∏ –∏–∑–≤–ª–µ—á–µ–Ω—ã', passed: metadata.tags.length > 0 },
  { name: '–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–≤–ª–µ—á–µ–Ω–æ', passed: metadata.description.length > 100 },
  { name: '–ö–Ω–∏–≥–∏ –∏–∑–≤–ª–µ—á–µ–Ω—ã', passed: metadata.books.length === 3 },
];

let passedCount = 0;
checks.forEach(check => {
  const icon = check.passed ? '‚úÖ' : '‚ùå';
  console.log(`   ${icon} ${check.name}`);
  if (check.passed) passedCount++;
});

console.log('');
console.log(`üìä –†–µ–∑—É–ª—å—Ç–∞—Ç: ${passedCount}/${checks.length} –ø—Ä–æ–≤–µ—Ä–æ–∫ –ø—Ä–æ–π–¥–µ–Ω–æ`);

if (passedCount === checks.length) {
  console.log('üéâ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!');
  process.exit(0);
} else {
  console.log('‚ö†Ô∏è  –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ –ø—Ä–æ–π–¥–µ–Ω—ã. –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞ –ø–∞—Ä—Å–µ—Ä–∞.');
  process.exit(1);
}

