import { config } from 'dotenv';
import { resolve } from 'path';

// Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ Ð¸Ð· .env Ñ„Ð°Ð¹Ð»Ð°
const envPath = resolve(__dirname, '../../.env');
config({ path: envPath });

async function checkSyncStatus() {
  try {
    console.log('ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑ‚Ð°Ñ‚ÑƒÑ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸ ÐºÐ½Ð¸Ð³...');
    
    // ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ GET Ð·Ð°Ð¿Ñ€Ð¾Ñ Ðº API endpoint
    const response = await fetch('http://localhost:3000/api/admin/sync-books', {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
      },
    });
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const data = await response.json();
    
    if (data.success) {
      const status = data.status;
      console.log('ðŸ“Š Ð¡Ñ‚Ð°Ñ‚ÑƒÑ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸:');
      console.log(`  Ð—Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð°: ${status.isRunning ? 'Ð”Ð°' : 'ÐÐµÑ‚'}`);
      console.log(`  Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ: ${status.message}`);
      console.log(`  ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ: ${status.progress || 0}%`);
      
      if (status.startTime) {
        const startTime = new Date(status.startTime);
        console.log(`  Ð’Ñ€ÐµÐ¼Ñ Ð½Ð°Ñ‡Ð°Ð»Ð°: ${startTime.toLocaleString()}`);
      }
    } else {
      console.log('âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ ÑÑ‚Ð°Ñ‚ÑƒÑÐ°:', data.message);
    }
  } catch (error) {
    console.error('âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ ÑÑ‚Ð°Ñ‚ÑƒÑÐ° ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸:', error);
  } finally {
    // ÐŸÑ€Ð¸Ð½ÑƒÐ´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð·Ð°Ð²ÐµÑ€ÑˆÐ°ÐµÐ¼ Ð¿Ñ€Ð¾Ñ†ÐµÑÑ Ñ‡ÐµÑ€ÐµÐ· 1 ÑÐµÐºÑƒÐ½Ð´Ñƒ
    setTimeout(() => {
      console.log('ðŸ”’ Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð¿Ñ€Ð¸Ð½ÑƒÐ´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½');
      process.exit(0);
    }, 1000);
  }
}

checkSyncStatus();