import { TelegramSyncService } from '../lib/telegram/sync';
import { MetadataParser } from '../lib/telegram/parser';

async function testSeriesCreation() {
  try {
    console.log('üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ä–∏–π –¥–ª—è –∫–Ω–∏–≥ —Å —Å–æ—Å—Ç–∞–≤–æ–º');
    
    // –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Å–æ—Å—Ç–∞–≤–æ–º
    const testMessage = `–ê–≤—Ç–æ—Ä: –ï–ª–∏–∑–∞–≤–µ—Ç–∞ –î–≤–æ—Ä–µ—Ü–∫–∞—è
–ù–∞–∑–≤–∞–Ω–∏–µ: —Ü–∏–∫–ª –ö–æ—Ä–∞–±–ª—å –≤–æ —Ñ—å–æ—Ä–¥–µ
–ñ–∞–Ω—Ä: #—Ñ—ç–Ω—Ç–µ–∑–∏ #–ø—Ä–∏–∫–ª—é—á–µ–Ω—á–µ—Å–∫–æ–µ #—Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ—Ñ—ç–Ω—Ç–µ–∑–∏ #–º–æ—Ä—Å–∫–∏–µ—Ñ—ç–Ω—Ç–µ–∑–∏ #–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è–∏—Å—Ç–æ—Ä–∏—è #–∑–∞–∫–æ–Ω—á–µ–Ω
–†–µ–π—Ç–∏–Ω–≥: 7.51 #–≤—ã—à–µ7
–ö–æ–≥–¥–∞ –≤–∏–∫–∏–Ω–≥–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç –∑–∞ —Ç–æ–±–æ–π ‚Äî –Ω–µ —Å—Ç–æ–∏—Ç —Å–¥–∞–≤–∞—Ç—å—Å—è –±–µ–∑ –±–æ—è. –¢–µ–º –±–æ–ª–µ–µ, –µ—Å–ª–∏ —Ç—ã —É–º–µ–µ—à—å —É–ø—Ä–∞–≤–ª—è—Ç—å –æ–≥–Ω—ë–º, –∏ —É —Ç–µ–±—è –µ—Å—Ç—å —Ç–∞–π–Ω–∞ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—É—é –ª—É—á—à–µ —Å–∫—Ä—ã–≤–∞—Ç—å. –ù–æ –∏ –≤ –±–µ–≥–∞ –º–æ–∂–Ω–æ —É–π—Ç–∏, –µ—Å–ª–∏ –ø–æ–≤–µ–∑—ë—Ç. –ì–ª–∞–≤–Ω–æ–µ ‚Äî –Ω–µ —É—Ç–æ–Ω—É—Ç—å –≤ –º–æ—Ä–µ, –Ω–µ —Å–≥–æ—Ä–µ—Ç—å –≤ –ø–ª–∞–º–µ–Ω–∏ –∏ –Ω–µ –≤–ª—é–±–∏—Ç—å—Å—è –≤ —á–µ–ª–æ–≤–µ–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å –ø—Ä–∏—á–∏–Ω–æ–π —Ç–≤–æ–µ–π –≥–∏–±–µ–ª–∏. –ò–ª–∏ —Å–ø–∞—Å—Ç–∏ —Ç–µ–±—è –æ—Ç –Ω–µ—ë.
–°–æ—Å—Ç–∞–≤:
–ö–æ—Ä–∞–±–ª—å –≤–æ —Ñ—å–æ—Ä–¥–µ (2018)
–ü–ª–∞–º—è –∏ –≤–æ–¥–∞ (2019)
–ü–µ–ø–µ–ª –∏ –ª—ë–¥ (2020)
–í–æ–ª–Ω–∞ –∏ –ø—Ä–∏–ª–∏–≤ (2021)`;

    console.log('\nüìù –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:');
    console.log(testMessage);
    
    // –ü–∞—Ä—Å–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    const metadata = MetadataParser.parseMessage(testMessage);
    console.log('\nüìä –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞:');
    console.log('- –ê–≤—Ç–æ—Ä:', metadata.author);
    console.log('- –ù–∞–∑–≤–∞–Ω–∏–µ:', metadata.title);
    console.log('- –ñ–∞–Ω—Ä—ã:', metadata.genres.join(', '));
    console.log('- –†–µ–π—Ç–∏–Ω–≥:', metadata.rating);
    console.log('- –û–ø–∏—Å–∞–Ω–∏–µ:', metadata.description);
    console.log('- –ö–Ω–∏–≥–∏ –≤ —Å–æ—Å—Ç–∞–≤–µ:', metadata.books.length);
    metadata.books.forEach((book, index) => {
      console.log(`  ${index + 1}. ${book.title} (${book.year})`);
    });
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏–∫—É —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ä–∏–∏
    if (metadata.books && metadata.books.length > 0) {
      console.log('\n‚úÖ –£ –∫–Ω–∏–≥–∏ –µ—Å—Ç—å —Å–æ—Å—Ç–∞–≤, —Å–µ—Ä–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–∞');
    } else {
      console.log('\n‚ùå –£ –∫–Ω–∏–≥–∏ –Ω–µ—Ç —Å–æ—Å—Ç–∞–≤–∞');
    }
    
    // –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–µ–∑ —Å–æ—Å—Ç–∞–≤–∞
    const testMessageWithoutComposition = `–ê–≤—Ç–æ—Ä: –ï–ª–∏–∑–∞–≤–µ—Ç–∞ –î–≤–æ—Ä–µ—Ü–∫–∞—è
–ù–∞–∑–≤–∞–Ω–∏–µ: –û–¥–∏–Ω–æ—á–Ω–∞—è –∫–Ω–∏–≥–∞
–ñ–∞–Ω—Ä: #—Ñ—ç–Ω—Ç–µ–∑–∏ #–ø—Ä–∏–∫–ª—é—á–µ–Ω—á–µ—Å–∫–æ–µ
–†–µ–π—Ç–∏–Ω–≥: 7.51 #–≤—ã—à–µ7
–≠—Ç–æ –ø—Ä–æ—Å—Ç–æ –æ–¥–∏–Ω–æ—á–Ω–∞—è –∫–Ω–∏–≥–∞ –±–µ–∑ —Å–æ—Å—Ç–∞–≤–∞.`;

    console.log('\n\nüìù –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–µ–∑ —Å–æ—Å—Ç–∞–≤–∞:');
    console.log(testMessageWithoutComposition);
    
    // –ü–∞—Ä—Å–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    const metadataWithoutComposition = MetadataParser.parseMessage(testMessageWithoutComposition);
    console.log('\nüìä –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞:');
    console.log('- –ê–≤—Ç–æ—Ä:', metadataWithoutComposition.author);
    console.log('- –ù–∞–∑–≤–∞–Ω–∏–µ:', metadataWithoutComposition.title);
    console.log('- –ñ–∞–Ω—Ä—ã:', metadataWithoutComposition.genres.join(', '));
    console.log('- –†–µ–π—Ç–∏–Ω–≥:', metadataWithoutComposition.rating);
    console.log('- –û–ø–∏—Å–∞–Ω–∏–µ:', metadataWithoutComposition.description);
    console.log('- –ö–Ω–∏–≥–∏ –≤ —Å–æ—Å—Ç–∞–≤–µ:', metadataWithoutComposition.books.length);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏–∫—É —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ä–∏–∏
    if (metadataWithoutComposition.books && metadataWithoutComposition.books.length > 0) {
      console.log('\n‚úÖ –£ –∫–Ω–∏–≥–∏ –µ—Å—Ç—å —Å–æ—Å—Ç–∞–≤, —Å–µ—Ä–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–∞');
    } else {
      console.log('\n‚úÖ –£ –∫–Ω–∏–≥–∏ –Ω–µ—Ç —Å–æ—Å—Ç–∞–≤–∞, —Å–µ—Ä–∏—è —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –Ω–µ –¥–æ–ª–∂–Ω–∞');
    }
    
    console.log('\n‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!');
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏:', error);
  }
}

// –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç
testSeriesCreation();