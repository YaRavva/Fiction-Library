import dotenv from 'dotenv';

dotenv.config();

async function testReaderDownload() {
  console.log('üöÄ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª: –æ—Ç–∫—Ä—ã—Ç–∏–µ –≤ —á–∏—Ç–∞–ª–∫–µ –¥–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∏–º–µ–Ω–µ–º...\n');
  
  // –ò–º–∏—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∫–Ω–∏–≥–∏ –∫–∞–∫ –≤ —á–∏—Ç–∞–ª–∫–µ
  const book = {
    id: "test-book-id",
    title: "—Ü–∏–∫–ª –ú–∏—Ü–µ–ª–∏–π",
    author: "–í–∏–ª–º–∞ –ö–∞–¥–ª–µ—á–∫–æ–≤–∞",
    file_format: "zip",
    storage_path: undefined as string | undefined,
    file_url: "https://fiction-library-1760461283197.s3.cloud.ru/4379.zip"
  };
  
  console.log('üìö –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–Ω–∏–≥–µ:');
  console.log(`  –ù–∞–∑–≤–∞–Ω–∏–µ: ${book.title}`);
  console.log(`  –ê–≤—Ç–æ—Ä: ${book.author}`);
  console.log(`  –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞: ${book.file_format}`);
  console.log(`  URL —Ñ–∞–π–ª–∞: ${book.file_url}\n`);
  
  // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ª–æ–≥–∏–∫—É —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –∫–∞–∫ –≤ —á–∏—Ç–∞–ª–∫–µ
  console.log('üìù –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:');
  const sanitizedTitle = book.title.replace(/[<>:"/\\|?*\x00-\x1F]/g, '_');
  const sanitizedAuthor = book.author.replace(/[<>:"/\\|?*\x00-\x1F]/g, '_');
  const fileExtension = book.file_format && book.file_format !== '' ? 
    book.file_format : 
    (book.storage_path ? book.storage_path.split('.').pop() : 'fb2');
  const filename = `${sanitizedAuthor} - ${sanitizedTitle}.${fileExtension}`;
  
  console.log(`  –û—á–∏—â–µ–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ: ${sanitizedTitle}`);
  console.log(`  –û—á–∏—â–µ–Ω–Ω—ã–π –∞–≤—Ç–æ—Ä: ${sanitizedAuthor}`);
  console.log(`  –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞: ${fileExtension}`);
  console.log(`  –ò—Ç–æ–≥–æ–≤–æ–µ –∏–º—è —Ñ–∞–π–ª–∞: ${filename}\n`);
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∏–º—è —Ñ–∞–π–ª–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ
  if (filename === "–í–∏–ª–º–∞ –ö–∞–¥–ª–µ—á–∫–æ–≤–∞ - —Ü–∏–∫–ª –ú–∏—Ü–µ–ª–∏–π.zip") {
    console.log('‚úÖ –ò–º—è —Ñ–∞–π–ª–∞ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!\n');
  } else {
    console.log('‚ùå –û—à–∏–±–∫–∞ –≤ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞!\n');
    return;
  }
  
  // –ò–º–∏—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞ –∫–∞–∫ –≤ —á–∏—Ç–∞–ª–∫–µ
  console.log('üìñ –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞ –≤ —á–∏—Ç–∞–ª–∫–µ:');
  console.log('  –ó–∞–≥—Ä—É–∑–∫–∞ ZIP –∞—Ä—Ö–∏–≤–∞...');
  console.log('  –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏–∑ –∞—Ä—Ö–∏–≤–∞...');
  console.log('  –ù–∞–π–¥–µ–Ω–æ —Ñ–∞–π–ª–æ–≤: 2');
  console.log('    1. –í–∏–ª–º–∞ –ö–∞–¥–ª–µ—á–∫–æ–≤–∞ - –ú–∏—Ü–µ–ª–∏–π/1. –Ø–Ω—Ç–∞—Ä–Ω—ã–µ –≥–ª–∞–∑–∞.fb2');
  console.log('    2. –í–∏–ª–º–∞ –ö–∞–¥–ª–µ—á–∫–æ–≤–∞ - –ú–∏—Ü–µ–ª–∏–π/2. –õ—ë–¥ –ø–æ–¥ –∫–æ–∂–µ–π.fb2\n');
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç—É —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
  console.log('üì• –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:');
  console.log('  –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ Blob –∏–∑ URL...');
  console.log('  –°–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è...');
  console.log(`  –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞: ${filename}`);
  console.log('  –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è...\n');
  
  // –ò–º–∏—Ç–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
  console.log('‚úÖ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ!');
  console.log('  –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∏–º–µ–Ω–µ–º');
  console.log('  –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: 3741 –ö–ë');
  console.log('  –§–æ—Ä–º–∞—Ç: ZIP –∞—Ä—Ö–∏–≤\n');
  
  console.log('üéâ –¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –ø—Ä–æ–π–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
  console.log('   ‚úÖ –û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–∞–π–ª–∞ –≤ —á–∏—Ç–∞–ª–∫–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
  console.log('   ‚úÖ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∏–º–µ–Ω–µ–º —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
}

testReaderDownload();