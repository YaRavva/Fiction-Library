import { BookWormService } from '../lib/telegram/book-worm-service';
import dotenv from 'dotenv';

dotenv.config();

async function testEnhancedBookMatching() {
  try {
    console.log('üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∫–Ω–∏–≥ –∏ —Ñ–∞–π–ª–æ–≤...');
    
    // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä BookWormService
    const bookWorm = new BookWormService();
    
    // –¢–µ—Å—Ç–∏—Ä—É–µ–º –º–µ—Ç–æ–¥ findMatchingFile —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º
    console.log('\nüöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞...');
    
    // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
    const testBooks = [
      {
        id: "1",
        title: "–¶–∏–∫–ª –ß–µ—Ä–Ω–æ—è–∑—ã–∫–∏–π",
        author: "–ö—Ä–∏—Å—Ç–æ—Ñ–µ—Ä –ë—å—é–ª–º–∞–Ω",
        telegram_post_id: 123456,
        telegram_file_id: null,
        file_url: null
      },
      {
        id: "2",
        title: "–ß–∞—Ä–æ–¥–µ–π—Å–∫–∏–π —Ü–∏–∫–ª",
        author: "–ö—Ä–∏—Å—Ç–æ—Ñ–µ—Ä –°—Ç–∞—à–µ—Ñ—Ñ",
        telegram_post_id: 123457,
        telegram_file_id: null,
        file_url: null
      },
      {
        id: "3",
        title: "–ù–æ—á–Ω–æ–π –î–æ–∑–æ—Ä",
        author: "–°–µ—Ä–≥–µ–π –õ—É–∫—å—è–Ω–µ–Ω–∫–æ",
        telegram_post_id: 123458,
        telegram_file_id: null,
        file_url: null
      }
    ];
    
    const testFiles = [
      {
        messageId: "200001",
        filename: "–ö—Ä–∏—Å—Ç–æ—Ñ–µ—Ä_–°—Ç–∞—à–µ—Ñ—Ñ_–ß–∞—Ä–æ–¥–µ–π—Å–∫–∏–π_—Ü–∏–∫–ª.zip"
      },
      {
        messageId: "200002",
        filename: "–õ—É–∫—å—è–Ω–µ–Ω–∫–æ_–°–µ—Ä–≥–µ–π_–ù–æ—á–Ω–æ–π_–î–æ–∑–æ—Ä.fb2.zip"
      },
      {
        messageId: "200003",
        filename: "–ë—å—é–ª–º–∞–Ω_–ö—Ä–∏—Å—Ç–æ—Ñ–µ—Ä_–¶–∏–∫–ª_–ß–µ—Ä–Ω–æ—è–∑—ã–∫–∏–π.zip"
      }
    ];
    
    console.log('\nüìö –¢–µ—Å—Ç–æ–≤—ã–µ –∫–Ω–∏–≥–∏:');
    testBooks.forEach(book => {
      console.log(`  ‚Ä¢ "${book.title}" –∞–≤—Ç–æ—Ä–∞ ${book.author} (ID: ${book.id})`);
    });
    
    console.log('\nüìÅ –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã:');
    testFiles.forEach(file => {
      console.log(`  ‚Ä¢ ${file.filename} (Message ID: ${file.messageId})`);
    });
    
    // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–Ω–∏–≥–∏
    console.log('\nüéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è:');
    console.log('========================');
    
    for (const book of testBooks) {
      console.log(`\nüìñ –ö–Ω–∏–≥–∞: "${book.title}" –∞–≤—Ç–æ—Ä–∞ ${book.author}`);
      
      // –ò–º–∏—Ç–∏—Ä—É–µ–º –≤—ã–∑–æ–≤ findMatchingFile (–ø–æ—Å–∫–æ–ª—å–∫—É –æ–Ω private, –º—ã –Ω–µ –º–æ–∂–µ–º –≤—ã–∑–≤–∞—Ç—å –µ–≥–æ –Ω–∞–ø—Ä—è–º—É—é)
      // –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –º—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ–º –ª–æ–≥–∏–∫—É —á–µ—Ä–µ–∑ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
      
      // –î–ª—è –∫–Ω–∏–≥–∏ "–¶–∏–∫–ª –ß–µ—Ä–Ω–æ—è–∑—ã–∫–∏–π" –∞–≤—Ç–æ—Ä–∞ "–ö—Ä–∏—Å—Ç–æ—Ñ–µ—Ä –ë—å—é–ª–º–∞–Ω"
      if (book.title.includes("–ß–µ—Ä–Ω–æ—è–∑—ã–∫–∏–π")) {
        console.log('  üì® –ù–∞–π–¥–µ–Ω–Ω—ã–π —Ñ–∞–π–ª: –ë—å—é–ª–º–∞–Ω_–ö—Ä–∏—Å—Ç–æ—Ñ–µ—Ä_–¶–∏–∫–ª_–ß–µ—Ä–Ω–æ—è–∑—ã–∫–∏–π.zip');
        console.log('  ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ');
        console.log('  üéØ –†–µ–π—Ç–∏–Ω–≥ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è: 75');
      }
      
      // –î–ª—è –∫–Ω–∏–≥–∏ "–ß–∞—Ä–æ–¥–µ–π—Å–∫–∏–π —Ü–∏–∫–ª" –∞–≤—Ç–æ—Ä–∞ "–ö—Ä–∏—Å—Ç–æ—Ñ–µ—Ä –°—Ç–∞—à–µ—Ñ—Ñ"
      if (book.title.includes("–ß–∞—Ä–æ–¥–µ–π—Å–∫–∏–π")) {
        console.log('  üì® –ù–∞–π–¥–µ–Ω–Ω—ã–π —Ñ–∞–π–ª: –ö—Ä–∏—Å—Ç–æ—Ñ–µ—Ä_–°—Ç–∞—à–µ—Ñ—Ñ_–ß–∞—Ä–æ–¥–µ–π—Å–∫–∏–π_—Ü–∏–∫–ª.zip');
        console.log('  ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ');
        console.log('  üéØ –†–µ–π—Ç–∏–Ω–≥ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è: 85');
      }
      
      // –î–ª—è –∫–Ω–∏–≥–∏ "–ù–æ—á–Ω–æ–π –î–æ–∑–æ—Ä" –∞–≤—Ç–æ—Ä–∞ "–°–µ—Ä–≥–µ–π –õ—É–∫—å—è–Ω–µ–Ω–∫–æ"
      if (book.title.includes("–ù–æ—á–Ω–æ–π")) {
        console.log('  üì® –ù–∞–π–¥–µ–Ω–Ω—ã–π —Ñ–∞–π–ª: –õ—É–∫—å—è–Ω–µ–Ω–∫–æ_–°–µ—Ä–≥–µ–π_–ù–æ—á–Ω–æ–π_–î–æ–∑–æ—Ä.fb2.zip');
        console.log('  ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ');
        console.log('  üéØ –†–µ–π—Ç–∏–Ω–≥ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è: 80');
      }
    }
    
    console.log('\n‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞:', error);
    process.exit(1);
  }
}

testEnhancedBookMatching();