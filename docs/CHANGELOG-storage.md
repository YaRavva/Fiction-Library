# üìã Changelog: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Supabase Storage

**–î–∞—Ç–∞:** 2025-10-02  
**–ê–≤—Ç–æ—Ä:** –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏  
**–í–µ—Ä—Å–∏—è:** 1.0.0

---

## üéØ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Supabase Storage –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∫–Ω–∏–≥ (FB2) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ bucket –∏ signed URLs.

---

## ‚úÖ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **–§–∞–π–ª:** `supabase/migrations/005_create_telegram_queue.sql`
- **–û–ø–∏—Å–∞–Ω–∏–µ:** 
  - –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `telegram_download_queue` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥—å—é –∑–∞–≥—Ä—É–∑–æ–∫
  - –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `download_queue` (legacy, –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
  - –î–æ–±–∞–≤–ª–µ–Ω—ã RPC —Ñ—É–Ω–∫—Ü–∏–∏:
    - `get_next_download_task()` - –∞—Ç–æ–º–∞—Ä–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–∏
    - `complete_download_task()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 2. API Endpoint
- **–§–∞–π–ª:** `src/app/api/admin/download-url/route.ts`
- **Endpoint:** `GET /api/admin/download-url`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö signed URLs –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤: `bookId`, `taskId`, `expiresIn`
  - –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É bucket —á–µ—Ä–µ–∑ service role

### 3. Worker (–æ–±–Ω–æ–≤–ª–µ–Ω)
- **–§–∞–π–ª:** `src/lib/telegram/worker.ts`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `serverSupabase` —Å service role key
  - –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª—ã –≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π bucket `books`
  - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç `storage_path` –≤ —Ç–∞–±–ª–∏—Ü–µ `download_queue`
  - –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∫–Ω–∏–≥–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `books`
  - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –∏ retry –ª–æ–≥–∏–∫—É

### 4. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **–§–∞–π–ª:** `docs/storage-setup.md`
  - –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Storage (8 —à–∞–≥–æ–≤)
  - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ RLS –ø–æ–ª–∏—Ç–∏–∫
  - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API
  - Troubleshooting –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
  
- **–§–∞–π–ª:** `docs/quick-start-storage.md`
  - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∑–∞ 5 –º–∏–Ω—É—Ç
  - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —à–∞–≥–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞
  - –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã

- **–§–∞–π–ª:** `docs/CHANGELOG-storage.md` (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
  - –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
  - –°–ø–∏—Å–æ–∫ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

### 5. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- **–§–∞–π–ª:** `supabase/README.md`
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Storage"
  - –û–±–Ω–æ–≤–ª–µ–Ω —Å–ø–∏—Å–æ–∫ "–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏"
  - –°—Å—ã–ª–∫–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  DownloadWorker ‚îÇ (src/lib/telegram/worker.ts)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Supabase Storage    ‚îÇ (private bucket: books)
‚îÇ  + serverSupabase    ‚îÇ (service role key)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  download_queue      ‚îÇ (storage_path —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è)
‚îÇ  books               ‚îÇ (storage_path + sync_status)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  API Endpoint        ‚îÇ (/api/admin/download-url)
‚îÇ  –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç signed   ‚îÇ
‚îÇ  URLs –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å        ‚îÇ (—Å–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–∞–π–ª –ø–æ signed URL)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–ü—Ä–∏–≤–∞—Ç–Ω—ã–π bucket** - —Ñ–∞–π–ª—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞–ø—Ä—è–º—É—é
2. **Service role key** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
3. **Signed URLs** - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º —Å—Ä–æ–∫–æ–º –¥–µ–π—Å—Ç–≤–∏—è
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤** - —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å URLs
5. **RLS –ø–æ–ª–∏—Ç–∏–∫–∏** - –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–¢—Ä–µ–±—É—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```env
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key  # ‚ö†Ô∏è –°–µ–∫—Ä–µ—Ç–Ω—ã–π!
SUPABASE_STORAGE_BUCKET=books
```

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü

### telegram_download_queue

```sql
CREATE TABLE telegram_download_queue (
  id UUID PRIMARY KEY,
  message_id TEXT NOT NULL,
  channel_id TEXT NOT NULL,
  file_id TEXT,
  book_id UUID REFERENCES books(id),
  status TEXT CHECK (status IN ('pending', 'processing', 'completed', 'failed')),
  error_message TEXT,
  retry_count INT DEFAULT 0,
  priority INT DEFAULT 0,
  scheduled_for TIMESTAMPTZ DEFAULT now(),
  started_at TIMESTAMPTZ,
  completed_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);
```

### download_queue (legacy)

```sql
CREATE TABLE download_queue (
  id UUID PRIMARY KEY,
  telegram_message_id TEXT,
  telegram_file_id TEXT,
  filename TEXT,
  size BIGINT,
  status TEXT DEFAULT 'pending',
  attempts INT DEFAULT 0,
  last_error TEXT,
  storage_path TEXT,  -- ‚Üê –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –≤ Storage
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);
```

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### 1. –ó–∞–ø—É—Å–∫ Worker

```typescript
import { DownloadWorker } from '@/lib/telegram/worker';

const worker = new DownloadWorker();
await worker.start();

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
console.log(worker.getStatus());

// –û—Å—Ç–∞–Ω–æ–≤–∫–∞
worker.stop();
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥—å

```typescript
import { DownloadQueue } from '@/lib/telegram/queue';

const queue = new DownloadQueue();
await queue.addTask({
  message_id: 'msg_123',
  channel_id: 'channel_456',
  file_id: 'telegram_file_id',
  book_id: 'book_uuid',
  priority: 1,
});
```

### 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è signed URL

```typescript
// –ß–µ—Ä–µ–∑ API
const response = await fetch('/api/admin/download-url?bookId=abc-123&expiresIn=3600');
const { url, expiresAt, storagePath } = await response.json();

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ URL
window.location.href = url; // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã
SELECT * FROM telegram_download_queue LIMIT 1;
SELECT * FROM download_queue LIMIT 1;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å RPC —Ñ—É–Ω–∫—Ü–∏–∏
SELECT get_next_download_task();
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ bucket

```sql
SELECT * FROM storage.buckets WHERE id = 'books';
-- –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: public = false
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ API

```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:3000/api/admin/download-url?bookId=YOUR_UUID"
```

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–¥–µ–ª–∞—Ç—å:

1. **–°–æ–∑–¥–∞—Ç—å bucket –≤ Supabase Dashboard**
   - –ò–º—è: `books`
   - Public: ‚ùå –û–¢–ö–õ–Æ–ß–ï–ù–û

2. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é**
   - –í—ã–ø–æ–ª–Ω–∏—Ç—å `005_create_telegram_queue.sql` –≤ SQL Editor

3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏**
   - –†–∞–∑—Ä–µ—à–∏—Ç—å service role –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ bucket

4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Worker**
   - –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞–¥–∞—á—É
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å worker
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–∞

5. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API**
   - –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∞
   - –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å signed URL
   - –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:

- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤
- –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–∑–º–µ—Ä–∞ bucket
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ñ–∞–π–ª–∞–º–∏
- –î–æ–±–∞–≤–∏—Ç—å rate limiting –¥–ª—è API

---

## üîó –°—Å—ã–ª–∫–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (5 –º–∏–Ω—É—Ç)](./quick-start-storage.md)
- [–ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ](./storage-setup.md)
- [Supabase Storage Docs](https://supabase.com/docs/guides/storage)
- [Signed URLs Guide](https://supabase.com/docs/guides/storage/signed-urls)

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ [Troubleshooting](./storage-setup.md#-troubleshooting) –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ worker'–∞ –∏ API
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ Supabase Dashboard

---

## ‚úÖ Checklist –¥–ª—è –¥–µ–ø–ª–æ—è

- [ ] Bucket `books` —Å–æ–∑–¥–∞–Ω (–ø—Ä–∏–≤–∞—Ç–Ω—ã–π)
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è `005_create_telegram_queue.sql` –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
- [ ] RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] `SUPABASE_SERVICE_ROLE_KEY` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ production env
- [ ] `SUPABASE_STORAGE_BUCKET=books` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] Worker –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –ª–æ–∫–∞–ª—å–Ω–æ
- [ ] API endpoint –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–î–∞—Ç–∞:** 2025-10-02

